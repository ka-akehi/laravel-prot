# データベースの正規化

## 非正規化構造のデータ

-   全てのデータを 1 つのテーブルで管理
-   1 つのセルに複数の値が含まれている

### raw_orders テーブル

| id  | customer_name | phone_number  | products  | prices  | address    |
| --- | ------------- | ------------- | --------- | ------- | ---------- |
| 1   | 田中          | 090-xxxx-yyyy | パン,牛乳 | 200,150 | 東京都港区 |

## 第 1 正規形のデータ

-   非正規形のデータ(カンマで区切のデータ)を分割し別テーブルに切り出す
    -   1 セルに 1 値が入っている状態にする
-   データベースの検索性・保守性・整合性の向上につながる

### orders テーブル

| id  | customer_name | phone_number  | address    |
| --- | ------------- | ------------- | ---------- |
| 1   | 田中          | 090-xxxx-yyyy | 東京都港区 |

### order_items テーブル

| id  | order_id | product_name | price |
| --- | -------- | ------------ | ----- |
| 1   | 1        | パン         | 200   |
| 2   | 1        | 牛乳         | 150   |

## 第 2 正規形のデータ

-   商品自体の属性である`product_name`と`price`を order_items から分離
    -   第一正規形のデータでは関数従属(「ある列 A の値が決まれば、列 B の値も一意に決まる」という関係性)を満たさない

### orders テーブル

| id  | customer_id | customer_name | phone_number  |
| --- | ----------- | ------------- | ------------- |
| 1   | 101         | 山田太郎      | 090-xxxx-xxxx |
| 2   | 102         | 鈴木花子      | 080-yyyy-yyyy |

### products テーブル

商品情報をマスタ化

| id  | name | price |
| --- | ---- | ----- |
| 1   | パン | 200   |
| 2   | 牛乳 | 150   |

### order_items テーブル

商品マスタを参照するだけ

| id  | order_id | product_id |
| --- | -------- | ---------- |
| 1   | 1        | 1          |
| 2   | 1        | 2          |

## 第 3 正規形のデータ

-   `order.customer_id`を通して間接的に`order.id`に依存している`customer_name`や`phone_number`を分離
    -   第二正規形では推移的関数従属になっている
        -   列：属性 A が属性 B に関数従属し、属性 B が主キーに関数従属しているとき、A は主キーに推移的関数従属している

### orders テーブル

customers テーブルのデータを参照するだけ

| id  | customer_id |
| --- | ----------- |
| 1   | 1001        |
| 2   | 1002        |

### customers テーブル

顧客情報は customers テーブルで管理

| id   | name     | phone_number  |
| ---- | -------- | ------------- |
| 1001 | 山田太郎 | 090-xxxx-xxxx |
| 1002 | 鈴木花子 | 080-yyyy-yyyy |
